(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{1322:(e,s,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/Result",function(){return n(1332)}])},1332:(e,s,n)=>{"use strict";n.r(s),n.d(s,{default:()=>l});var t=n(4848),a=n(6540),i=n(9781),o=n.n(i);let l=e=>{let{setScreen:s,saveData:n,setSaveData:i,sender:l,getPlace:r}=e,[c,u]=(0,a.useState)(""),[d,g]=(0,a.useState)(""),[m,_]=(0,a.useState)(""),p=!0;(0,a.useEffect)(()=>{p&&(p=!1,v())},[]);let v=()=>{u(n.question.stage+1);let e=L.map("guess_map_canvas",{zoomControl:!1});L.tileLayer("https://www.google.com/maps/vt?pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i693439125!3m12!2sja!3sJP!5e289!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!4e0!5m1!5f2",{attribution:"\xa9Ô∏è <a href='https://www.google.com/maps/' target='_blank'>Google</a>",maxZoom:20,maxNativeZoom:20}).addTo(e),new ResizeObserver(()=>{e.invalidateSize()}).observe(e._container);let t=n.question,a=L.latLng([Number(t.lat),Number(t.lng)]),o=-1,c=0;if(t.guess_lat){let s=L.icon({iconUrl:"/freeguessr/images/guess.svg",iconSize:[24,24],iconAnchor:[12,12]}),i=L.marker([Number(t.guess_lat),Number(t.guess_lng)],{icon:s}).addTo(e);L.polyline([a,i.getLatLng()],{color:"black",weight:2,dashArray:"4 4"}).addTo(e),e.fitBounds(L.latLngBounds([a,i.getLatLng()]),{padding:[30,30]}),c=Math.round(5e3*Math.exp(-((o=a.distanceTo(i.getLatLng()))/1e3)/n.score_scale))}else e.setView([a.lat,a.lng],10);t.score=c,n.score+=t.score;let d="",m=async()=>{d=await r(n.map_id)},p=0,v="",h=0,f=async()=>{var e=new XMLHttpRequest;return e.open("HEAD","".concat(location.href,"?nocache=").concat(Date.now()),!1),e.send(null),new Date(e.getResponseHeader("Date"))-new Date},w=async()=>{p=await f(),v=new Date().getTime(),h=performance.now()},x=()=>v+p+performance.now()-h,y=async()=>{let e=n.question;await w(),e.duration=Math.min(Math.floor((x()-n.question.start_time)/1e3),n.limit_time),n.duration+=e.duration,i({question:JSON.stringify(e)});let s=await l("guess",n);"success"===s.status?(n.question=e,loading.style.display="none"):(alert("Error: "+s.message),location.reload())};n.question.stage<n.stage_num&&m(),"continue"in n?loading.style.display="none":y(),e.invalidateSize();let b=L.icon({iconUrl:"/freeguessr/images/flag.svg",iconSize:[25,50],iconAnchor:[12.5,47]});L.marker(a,{icon:b}).addTo(e);let N="Timeout";o>=0&&(N=o<1e3?Math.round(o).toLocaleString()+" m":o<1e4?(Math.round(o/100)/10).toLocaleString()+" km":Math.round(o/1e3).toLocaleString()+" km"),g(N);let j=c.toLocaleString();_(j+=1==c?" point":" points");let k=!1,E=async e=>{""==v&&await w(),n.send_flag=!0,n.question={stage:n.question.stage+1,start_time:x(),pano_id:null,heading:null,lat:e[0],lng:e[1],guess_lat:null,guess_lng:null,score:0,duration:null},s("play")};next_btn.addEventListener("click",()=>{if(!k&&"none"==loading.style.display){if(k=!0,n.question.stage==n.stage_num)s("end");else{loading.style.display="flex";let e=setInterval(()=>{""!=d&&(clearInterval(e),E(d))},1)}}})};return(0,a.useEffect)(()=>{let e=e=>{("Enter"===e.key||" "===e.key)&&"undefined"!=typeof next_btn&&next_btn.click()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[c,d,m]),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{id:"loading",className:o().loading,children:[(0,t.jsx)("img",{className:o().loadingIcon,src:"/freeguessr/images/compass.svg",alt:"Loading"}),(0,t.jsx)("div",{children:"loading..."})]}),(0,t.jsx)("div",{className:o()["guess-map"],children:(0,t.jsx)("div",{id:"guess_map_canvas",className:o()["guess-map-canvas"]})}),(0,t.jsxs)("div",{className:o().controls,children:[(0,t.jsx)("div",{className:o().round,children:(0,t.jsxs)("div",{children:["Round ",c]})}),(0,t.jsxs)("div",{className:o()["results-container"],children:[(0,t.jsx)("div",{children:d}),(0,t.jsx)("div",{children:m})]}),(0,t.jsx)("button",{id:"next_btn",className:o()["next-btn"],children:"NEXT"})]})]})}},9781:e=>{e.exports={"guess-map":"result_guess-map__WxqEP","guess-map-canvas":"result_guess-map-canvas__mCAu7",controls:"result_controls__PeGYl","results-container":"result_results-container__FlTml",round:"result_round__Sm0e2","next-btn":"result_next-btn__VLj7M",loading:"result_loading__xfA6c",loadingIcon:"result_loadingIcon__tnSEj",spin:"result_spin__WS2lf"}}},e=>{var s=s=>e(e.s=s);e.O(0,[636,593,792],()=>s(1322)),_N_E=e.O()}]);