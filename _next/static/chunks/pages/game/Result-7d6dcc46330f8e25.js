(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{1322:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/Result",function(){return t(1332)}])},1332:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var n=t(4848),a=t(6540),i=t(9781),l=t.n(i);let o=e=>{let{setScreen:s,saveData:t,setSaveData:i,sender:o,getPlace:r}=e,[d,u]=(0,a.useState)(""),[c,g]=(0,a.useState)(""),[m,_]=(0,a.useState)(""),p=!0;(0,a.useEffect)(()=>{p&&(p=!1,v())},[]);let v=()=>{u(t.question.stage+1);let e=L.map("guess_map_canvas",{zoomControl:!1});L.tileLayer("https://www.google.com/maps/vt?pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i693439125!3m12!2sja!3sJP!5e289!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!4e0!5m1!5f2",{attribution:"\xa9Ô∏è <a href='https://www.google.com/maps/' target='_blank'>Google</a>",maxZoom:20,maxNativeZoom:20}).addTo(e),new ResizeObserver(()=>{e.invalidateSize()}).observe(e._container);let n=t.question,a=L.latLng([Number(n.lat),Number(n.lng)]),l=-1,d=0;if(n.guess_lat){let s=L.icon({iconUrl:"/freeguessr/images/guess.svg",iconSize:[24,24],iconAnchor:[12,12]}),i=L.marker([Number(n.guess_lat),Number(n.guess_lng)],{icon:s}).addTo(e);L.polyline([a,i.getLatLng()],{color:"black",weight:2,dashArray:"4 4"}).addTo(e),e.fitBounds(L.latLngBounds([a,i.getLatLng()]),{padding:[30,30]}),d=Math.round(5e3*Math.exp(-((l=a.distanceTo(i.getLatLng()))/1e3)/t.score_scale))}else e.setView([a.lat,a.lng],10);n.score=d,t.score+=n.score;let c="",m=async()=>{c=await r(t.map_id)},p=0,v="",h=0,x=async()=>{var e=new XMLHttpRequest;return e.open("HEAD","#",!1),e.send(null),new Date(e.getResponseHeader("Date"))-new Date},f=async()=>{p=await x(),v=new Date().getTime()},w=()=>v+p+h,y=setInterval(()=>{"undefined"==typeof next_btn&&clearInterval(y),""!=v&&(h+=10)},10),b=async()=>{let e=t.question;await f(),e.duration=Math.min(Math.floor((w()-t.question.start_time)/1e3),t.limit_time),t.duration+=e.duration,i({question:JSON.stringify(e)});let s=await o("guess",t);"success"===s.status?(t.question=e,loading.style.display="none"):(alert("Error: "+s.message),location.reload())};t.question.stage<t.stage_num&&m(),"continue"in t?loading.style.display="none":b(),e.invalidateSize();let N=L.icon({iconUrl:"/freeguessr/images/flag.svg",iconSize:[25,50],iconAnchor:[12.5,47]});L.marker(a,{icon:N}).addTo(e);let j="Timeout";l>=0&&(j=l<1e3?Math.round(l).toLocaleString()+" m":l<1e4?(Math.round(l/100)/10).toLocaleString()+" km":Math.round(l/1e3).toLocaleString()+" km"),g(j);let k=d.toLocaleString();_(k+=1==d?" point":" points");let E=!1,S=async e=>{""==v&&await f(),t.send_flag=!0,t.question={stage:t.question.stage+1,start_time:w(),pano_id:null,heading:null,lat:e[0],lng:e[1],guess_lat:null,guess_lng:null,score:0,duration:null},s("play")};next_btn.addEventListener("click",()=>{if(!E&&"none"==loading.style.display){if(E=!0,t.question.stage==t.stage_num)s("end");else{loading.style.display="flex";let e=setInterval(()=>{""!=c&&(clearInterval(e),S(c))},1)}}})};return(0,a.useEffect)(()=>{let e=e=>{("Enter"===e.key||" "===e.key)&&"undefined"!=typeof next_btn&&next_btn.click()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[d,c,m]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{id:"loading",className:l().loading,children:[(0,n.jsx)("img",{className:l().loadingIcon,src:"/freeguessr/images/compass.svg",alt:"Loading"}),(0,n.jsx)("div",{children:"loading..."})]}),(0,n.jsx)("div",{className:l()["guess-map"],children:(0,n.jsx)("div",{id:"guess_map_canvas",className:l()["guess-map-canvas"]})}),(0,n.jsxs)("div",{className:l().controls,children:[(0,n.jsx)("div",{className:l().round,children:(0,n.jsxs)("div",{children:["Round ",d]})}),(0,n.jsxs)("div",{className:l()["results-container"],children:[(0,n.jsx)("div",{children:c}),(0,n.jsx)("div",{children:m})]}),(0,n.jsx)("button",{id:"next_btn",className:l()["next-btn"],children:"NEXT"})]})]})}},9781:e=>{e.exports={"guess-map":"result_guess-map__WxqEP","guess-map-canvas":"result_guess-map-canvas__mCAu7",controls:"result_controls__PeGYl","results-container":"result_results-container__FlTml",round:"result_round__Sm0e2","next-btn":"result_next-btn__VLj7M",loading:"result_loading__xfA6c",loadingIcon:"result_loadingIcon__tnSEj",spin:"result_spin__WS2lf"}}},e=>{var s=s=>e(e.s=s);e.O(0,[636,593,792],()=>s(1322)),_N_E=e.O()}]);