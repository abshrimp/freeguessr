(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{1322:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/Result",function(){return s(1332)}])},1332:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var n=s(4848),a=s(6540),i=s(9781),o=s.n(i);let l=e=>{let{setScreen:t,saveData:s,setSaveData:i,sender:l,getPlace:r}=e,[u,c]=(0,a.useState)(""),[d,g]=(0,a.useState)(""),[m,_]=(0,a.useState)(""),p=!0;(0,a.useEffect)(()=>{p&&(p=!1,v())},[]);let v=()=>{c(s.question.stage+1);let e=L.map("guess_map_canvas",{zoomControl:!1});L.tileLayer("https://www.google.com/maps/vt?pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i693439125!3m12!2sja!3sJP!5e289!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!4e0!5m1!5f2",{attribution:"\xa9Ô∏è <a href='https://www.google.com/maps/' target='_blank'>Google</a>",maxZoom:20,maxNativeZoom:20}).addTo(e),new ResizeObserver(()=>{e.invalidateSize()}).observe(e._container);let n=s.question,a=L.latLng([Number(n.lat),Number(n.lng)]),o=-1,u=0;if(n.guess_lat){let t=L.icon({iconUrl:"/freeguessr/images/guess.svg",iconSize:[24,24],iconAnchor:[12,12]}),i=L.marker([Number(n.guess_lat),Number(n.guess_lng)],{icon:t}).addTo(e);L.polyline([a,i.getLatLng()],{color:"black",weight:2,dashArray:"4 4"}).addTo(e),e.fitBounds(L.latLngBounds([a,i.getLatLng()]),{padding:[30,30]}),u=Math.round(5e3*Math.exp(-((o=a.distanceTo(i.getLatLng()))/1e3)/s.score_scale))}else e.setView([a.lat,a.lng],10);n.score=u,s.score+=n.score;let d="",m=async()=>{d=await r(s.map_id)},p=0,v="",h=0,f=async()=>{var e=new XMLHttpRequest;return e.open("HEAD","".concat(location.href,"?nocache=").concat(Date.now()),!1),e.send(null),new Date(e.getResponseHeader("Date"))-new Date},w=async()=>{p=await f(),v=new Date().getTime(),h=performance.now()},x=()=>v+p+performance.now()-h,y=async()=>{let e=s.question;await w(),e.duration=Math.floor((x()-s.question.start_time)/1e3),s.limit_time>0&&e.duration>s.limit_time&&(e.duration=s.limit_time),s.duration+=e.duration,i({question:JSON.stringify(e)});let t=await l("guess",s);"success"===t.status?(s.question=e,loading.style.display="none"):(alert("Error: "+t.message),location.reload())};s.question.stage<s.stage_num&&m(),"continue"in s?loading.style.display="none":y(),e.invalidateSize();let b=L.icon({iconUrl:"/freeguessr/images/flag.svg",iconSize:[25,50],iconAnchor:[12.5,47]});L.marker(a,{icon:b}).addTo(e);let N="Timeout";o>=0&&(N=o<1e3?Math.round(o).toLocaleString()+" m":o<1e4?(Math.round(o/100)/10).toLocaleString()+" km":Math.round(o/1e3).toLocaleString()+" km"),g(N);let j=u.toLocaleString();_(j+=1==u?" point":" points");let k=!1,E=async e=>{""==v&&await w(),s.send_flag=!0,s.question={stage:s.question.stage+1,start_time:x(),pano_id:null,heading:null,lat:e[0],lng:e[1],guess_lat:null,guess_lng:null,score:0,duration:null},t("play")};next_btn.addEventListener("click",()=>{if(!k&&"none"==loading.style.display){if(k=!0,s.question.stage==s.stage_num)t("end");else{loading.style.display="flex";let e=setInterval(()=>{""!=d&&(clearInterval(e),E(d))},1)}}})};return(0,a.useEffect)(()=>{let e=e=>{("Enter"===e.key||" "===e.key)&&"undefined"!=typeof next_btn&&next_btn.click()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[u,d,m]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{id:"loading",className:o().loading,children:[(0,n.jsx)("img",{className:o().loadingIcon,src:"/freeguessr/images/compass.svg",alt:"Loading"}),(0,n.jsx)("div",{children:"loading..."})]}),(0,n.jsx)("div",{className:o()["guess-map"],children:(0,n.jsx)("div",{id:"guess_map_canvas",className:o()["guess-map-canvas"]})}),(0,n.jsxs)("div",{className:o().controls,children:[(0,n.jsx)("div",{className:o().round,children:(0,n.jsxs)("div",{children:["Round ",u]})}),(0,n.jsxs)("div",{className:o()["results-container"],children:[(0,n.jsx)("div",{children:d}),(0,n.jsx)("div",{children:m})]}),(0,n.jsx)("button",{id:"next_btn",className:o()["next-btn"],children:"NEXT"})]})]})}},9781:e=>{e.exports={"guess-map":"result_guess-map__WxqEP","guess-map-canvas":"result_guess-map-canvas__mCAu7",controls:"result_controls__PeGYl","results-container":"result_results-container__FlTml",round:"result_round__Sm0e2","next-btn":"result_next-btn__VLj7M",loading:"result_loading__xfA6c",loadingIcon:"result_loadingIcon__tnSEj",spin:"result_spin__WS2lf"}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(1322)),_N_E=e.O()}]);