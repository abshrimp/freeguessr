(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[791],{6791:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(4848),n=s(6540),o=s(9965),i=s.n(o),l=s(1258),c=s.n(l);let r=e=>{var t;let{setScreen:s,saveData:o,setSaveData:l,sender:r,getPlace:m}=e,[d,u]=(0,n.useState)(null),[p,g]=(0,n.useState)("/freeguessr/images/".concat("icon-add-checkpoint.svg")),[_,h]=(0,n.useState)("PLACE YOUR PIN ON THE MAP"),[v,y]=(0,n.useState)(""),[f,N]=(0,n.useState)(""),[b,w]=(0,n.useState)("-"),[x,j]=(0,n.useState)(0),k=(0,n.useRef)([]),E=(0,n.useRef)([]),S=()=>{["S","SW","W","NW","N","NE","E","SE"].forEach(e=>{let t=document.createElement("div");t.className=c()["latitude-item"],t.style.width="5.4375rem",t.style.transform="translate(-2.71875rem)";let s=.328125;for(let e=0;e<6;e++){3==e&&(s+=1.5);let a=document.createElement("span");a.className=c()["latitude-lines"],a.style.left="".concat(s,"rem"),t.appendChild(a),s+=.65625}let a=document.createElement("span");"N"==e?a.className="".concat(c().north," ").concat(c()["latitude-label"]):a.className=c()["latitude-label"],a.textContent=e,t.appendChild(a),compassContainer.appendChild(t)}),k.current=Array.from(document.getElementsByClassName(c()["latitude-item"])),E.current=Array.from(document.getElementsByClassName(c()["latitude-label"]))},q=async()=>{var e=new XMLHttpRequest;return e.open("HEAD","#",!1),e.send(null),new Date(e.getResponseHeader("Date"))-new Date},I=!0;(0,n.useEffect)(()=>{if(I){I=!1;let e=setInterval(()=>{"undefined"!=typeof L&&(clearInterval(e),z())},1)}},[]);let z=async()=>{if(S(),"daily"in o){navi.style.display="none",daily_navi.style.display="",o.move_count=-1;let e=await m();if(o.question.pano_id=e.pano_id,o.question.stage=e.num,o.question.lat=String(e.lat),o.question.lng=String(e.lng),localStorage.getItem("stage")==o.question.stage){if(localStorage.getItem("guess_lat")){s("result");return}o.move_count=localStorage.getItem("move_count"),o.move_count-=1}else localStorage.clear(),localStorage.setItem("stage",o.question.stage),localStorage.setItem("move_count",0),localStorage.setItem("lat",o.question.lat),localStorage.setItem("lng",o.question.lng);N(o.question.stage)}else N(o.question.stage+1),w(o.stage_num+1);let e=setInterval(()=>{if("undefined"==typeof streetView){clearInterval(e);return}streetView.contentWindow.panorama&&(clearInterval(e),P(streetView.contentWindow.panorama))},1);o.question.pano_id?u("/freeguessr/embed.html?game_type=".concat(o.game_type,"&pb=!4v0!6m3!1m2!1s").concat(o.question.pano_id,"!3f").concat(Number(o.question.heading))):u("/freeguessr/embed.html?game_type=".concat(o.game_type,"&pb=!4v0!6m4!1m3!2m2!1d").concat(o.question.lat,"!2d").concat(o.question.lng)),M()},P=e=>{let t=e=>{let t=k.current,s=E.current,a=-(((e+22.5+180)%360-180)*43.5/360);for(let e=0;e<t.length;e++){let n=a;a>10&&e>5&&(n-=43.5),a<-10&&e<2&&(n+=43.5),t[e].style="width: 5.4375rem; transform: translate(".concat(n,"rem);"),s[e].style=""}5>Math.abs((e+22.5+180)%45-22.5)&&(s[(Math.round(e/45)+4)%8].style="transform: scale(1.4)")},a=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=e.getZoom(),o=Math.max(Math.min(a+t,4),1),i=performance.now(),l=e=>e*(2-e),c=()=>{let t=Math.min((performance.now()-i)/s,1);e.setZoom(a+(o-a)*l(t)),t<1&&requestAnimationFrame(c),n(e)};requestAnimationFrame(c)},n=()=>{let t=" ".concat(c()["button-disabled"]),s=e.getZoom();s>=3.8?zoomIn.className.includes(t)||(zoomIn.className+=t):zoomIn.className=zoomIn.className.replace(t,""),s<=1.2?zoomOut.className.includes(t)||(zoomOut.className+=t):zoomOut.className=zoomOut.className.replace(t,"")},i=[],m=0,d=()=>{let e=" ".concat(c()["button-disabled"]);goBack.disabled=i.length<=1,i.length<=1?goBack.className.includes(e)||(goBack.className+=e):goBack.className=goBack.className.replace(e,"")},u=()=>{if(m||i.length<=1)return;m+=2,i.pop();let t=i[i.length-1];e.setPosition(t[0]),d(),setTimeout(()=>e.setPov({heading:t[1],pitch:t[2]}),150)},p=()=>{let t=i[0];i=[t],m=2,e.setPosition(t[0]),d(),setTimeout(()=>e.setPov({heading:Number(o.question.heading),pitch:0}),150)},_=[],h=()=>{if(_.length>0){m+=2,e.setPosition(_[0]);let t=[_[1],_[2]];setTimeout(()=>e.setPov({heading:t[0],pitch:t[1]}),150),_=[],g("/freeguessr/images/".concat("icon-add-checkpoint.svg"))}else{let t=e.getPov();_=[e.getPosition().toJSON(),t.heading,t.pitch],g("/freeguessr/images/".concat("icon-return-to-checkpoint.svg"))}},v=!1,y=async()=>{if(!v){if("daily"in o){window.confirm("ホームに戻りますか？")&&(location.href="/freeguessr");return}if(window.confirm("中断してもよろしいですか？\n(続きからの再開はできません)")){v=!0,loading.style.display="flex";let e=await q();o.question.duration=Math.min(Math.floor((new Date().getTime()+e-o.question.start_time)/1e3),o.limit_time),o.question=JSON.stringify(o.question);let t=await r("exit",o);"success"===t.status?s("settings"):(alert("Error: "+t.message),location.reload())}}},f={},N=async e=>{let t=await r(e,o);"success"===t.status?("id"in t&&(o.id=t.id),"data"in t&&l(t.data),o.question=f,close_btn.addEventListener("click",y)):(alert("Error: "+t.message),location.reload())};if("send_flag"in o){let t=new Date().getTime(),s=setInterval(async()=>{let a=e.getPosition();a?(clearInterval(s),o.question.lat=String(a.lat()),o.question.lng=String(a.lng()),o.question.pano_id=e.getPano(),o.question.heading=String(e.getPov().heading),f=o.question,o.question=JSON.stringify(f),0==f.stage?(o.game_state=JSON.stringify({questions:[f]}),await N("start")):await N("next"),delete o.send_flag):new Date().getTime()-t>8e3&&(clearInterval(s),alert("ストリートビューの取得に失敗しました"),location.reload())},1)}else close_btn.addEventListener("click",y);let b=t=>{Math.floor(o.game_type/10)%10==1&&(t.addEventListener("mousedown",e=>{e.stopPropagation()}),t.addEventListener("wheel",t=>{t.stopPropagation(),Math.floor(o.game_type/100)%10==0&&e.setZoom(Math.max(Math.min(e.getZoom()+t.wheelDelta/1e3,4)),1)}),t.addEventListener("pointerdown",e=>{e.stopPropagation()}),t.addEventListener("touchstart",e=>{e.stopPropagation()}),Math.floor(o.game_type/100)%10==0&&(controlZoom.className+=" ".concat(c()["control-zoom-display"]))),Math.floor(o.game_type/100)%10==1&&t.addEventListener("wheel",e=>{e.stopPropagation()})},w=setInterval(()=>{if("undefined"==typeof streetView){clearInterval(w);return}let t=streetView.contentWindow.document.getElementsByTagName("canvas");t.length>0&&(clearInterval(w),e.setZoom(0),b(t[0]),t[0].addEventListener("keydown",e=>{" "==e.key&&guess_btn.click()}))},1);e.addListener("pov_changed",()=>{t(e.getPov().heading)}),Math.floor(o.game_type/100)%10==1?(zoomIn.style.display="none",zoomOut.style.display="none"):(zoomIn.addEventListener("click",()=>a(1)),zoomOut.addEventListener("click",()=>a(-1))),e.addListener("zoom_changed",n),e.addListener("position_changed",()=>{if(m){m--;return}"move_count"in o&&(o.move_count+=1,j(o.move_count),localStorage.setItem("move_count",o.move_count));let t=i[i.length-1];if(t){let s=e.getPov();[t[1],t[2]]=[s.heading,s.pitch]}let s=e.getPosition();s&&i.push([s.toJSON(),0,0]),d()}),o.game_type%10==1?(goBack.style.display="none",goStart.style.display="none",goCheckpoint.style.display="none"):(goBack.addEventListener("click",u),goStart.addEventListener("click",p),goCheckpoint.addEventListener("click",h),streetView.contentWindow.addEventListener("keydown",e=>{("z"==e.key||"Z"==e.key)&&u(),("r"==e.key||"R"==e.key)&&p(),("c"==e.key||"C"==e.key)&&h()}))},C=e=>{if("undefined"==typeof streetView)return;let t=streetView.contentWindow.document.getElementsByTagName("canvas");if(t.length>0){let s=new KeyboardEvent(e.type,{bubbles:!0,cancelable:!0,key:e.key,code:e.code,keyCode:e.keyCode});" "==e.key?streetView.contentWindow.dispatchEvent(s):t[0].dispatchEvent(s)}};(0,n.useEffect)(()=>(document.addEventListener("keydown",C),document.addEventListener("keyup",C),()=>{document.removeEventListener("keydown",C),document.removeEventListener("keyup",C)}),[d,p,_,v,f,b]);let M=()=>{let e,t,a,n;console.log(document.documentElement.clientWidth);let i=L.map("guess_map_canvas",{zoomControl:document.documentElement.clientWidth>679}),l=null,r=e=>{let t=Math.floor(e/3600),s=Math.floor(e%3600/60),a;a=t<100?"00".concat(t).slice(-2):t;let n="00".concat(s).slice(-2),o="00".concat(e%60).slice(-2);return 0!==t?"".concat(a,":").concat(n,":").concat(o):"".concat(n,":").concat(o)},m=e=>{progress.style.strokeDashoffset=(1-e/o.limit_time)*467.347,e<=10&&(progress.style.stroke="red")},d=0,u="",p=0;(async()=>{d=await q(),u=new Date().getTime()})();let g=()=>u+d+p,_=setInterval(()=>{if("undefined"==typeof progress){clearInterval(_);return}if(""!=u&&(p+=10),0==o.limit_time)y("∞"),m(0),clearInterval(_);else if(o.question.start_time&&""!=u){let e=Math.min(o.limit_time,o.limit_time-(g()-o.question.start_time)/1e3);y(r(Math.ceil(e))),m(e),e<=0&&f()}},10),v=!1,f=()=>{if("send_flag"in o||""==u||o.limit_time-(g()-o.question.start_time)>0&&!l||v||"string"==typeof o.question)return;clearInterval(_),v=!0;let e=o.question;if(l){let t=l.getLatLng(),s=t.lng%360;s<Number(e.lng)-180?s+=360:Number(e.lng)+180<s&&(s-=360),e.guess_lat=String(t.lat),e.guess_lng=String(s)}"continue"in o&&delete o.continue,"daily"in o&&(localStorage.setItem("guess_lat",e.guess_lat),localStorage.setItem("guess_lng",e.guess_lng)),s("result")};guess_btn.addEventListener("click",f),guess_map_canvas.addEventListener("keydown",e=>{" "==e.key&&f()});let N=L.icon({iconUrl:"/freeguessr/images/guess.svg",iconSize:[24,24],iconAnchor:[12,12]});document.documentElement.clientWidth>679&&i.zoomControl.setPosition("topright"),i.setView([35.4,136],5),i.on("click",e=>{i&&(l?i.removeLayer(l):(h("GUESS"),guess_btn.className=guess_btn.className.replace(c()["button-disabled"],"")+" ".concat(c()["guess-allowed"]),guess_btn.disabled=!1),l=L.marker(e.latlng,{icon:N}).addTo(i))}),L.tileLayer("https://www.google.com/maps/vt?pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i693439125!3m12!2sja!3sJP!5e289!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!4e0!5m1!5f2",{attribution:"\xa9️ <a href='https://www.google.com/maps/' target='_blank'>Google</a>",maxZoom:20,maxNativeZoom:20}).addTo(i),new ResizeObserver(()=>{i.invalidateSize()}).observe(i._container);let b=s=>{guess_map_canvas.style="--map-width:".concat(a-s.clientX+e,"px; --map-height:").concat(n-s.clientY+t,"px;")},w=()=>{streetView.className=streetView.className.replace(" ".concat(c()["street-view-stop"]),""),guess_map_canvas.className=guess_map_canvas.className.replace(" ".concat(c()["guess-map-canvas-resize"]),""),document.documentElement.removeEventListener("mousemove",b,!1),document.documentElement.removeEventListener("mouseup",w,!1)};resizer.addEventListener("mousedown",s=>{s.stopPropagation(),e=s.clientX,t=s.clientY,a=parseInt(window.getComputedStyle(guess_map_canvas).width,10),n=parseInt(window.getComputedStyle(guess_map_canvas).height,10),guess_map_canvas.className+=" ".concat(c()["guess-map-canvas-resize"]),streetView.className+=" ".concat(c()["street-view-stop"]),document.documentElement.addEventListener("mousemove",b,!1),document.documentElement.addEventListener("mouseup",w,!1)},!1);let x=!1;pinner.addEventListener("click",e=>{e.stopPropagation(),x?(x=!1,pinner.className=pinner.className.replace(" ".concat(c()["pinner-pin"]),""),guess_map.className=guess_map.className.replace(" ".concat(c()["guess-map-hover"]),"")):(x=!0,pinner.className+=" ".concat(c()["pinner-pin"]),guess_map.className+=" ".concat(c()["guess-map-hover"]))},!1),guess_map_toggle.addEventListener("click",()=>{""==guess_map.style.display?guess_map.style.display="block":guess_map.style.display=""})};return(0,a.jsxs)("div",{className:c()["game-root"],children:[(0,a.jsxs)("div",{id:"loading",className:c().loading,children:[(0,a.jsx)("img",{className:c().loadingIcon,src:"/freeguessr/images/compass.svg",alt:"Loading"}),(0,a.jsx)("div",{children:"loading..."})]}),(0,a.jsx)("div",{className:c()["street-view-container"],children:(0,a.jsx)("iframe",{id:"streetView",src:d,className:c()["street-view"],loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"})}),(0,a.jsx)("div",{className:c()["clock-container"],children:(0,a.jsxs)("div",{className:c()["timer-container"],children:[(0,a.jsx)("div",{className:c().timer,children:v}),(0,a.jsx)("svg",{className:c()["timer-svg"],width:"100%",height:"100%",viewBox:"0 0 200 80",preserveAspectRatio:"none",children:(0,a.jsx)("path",{id:"progress",className:c()["timer-path"],fill:"rgba(0,0,0,0)",strokeWidth:"8",d:"M 100 4 L 38.56 4 C 19.55 4 4 20.2 4 40 c 0 19.8 15.55 36 34.56 36 h 122.88 C 180.45 76 196 59.8 196 40 c 0 -19.8 -15.55 -36 -34.56 -36 H 100 z",style:{strokeDasharray:"467.347",strokeDashoffset:"467.347",stroke:"var(--ds-color-green-80)"}})})]})}),(0,a.jsx)("div",{className:c()["panorama-layout"],"data-qa":"question",children:(0,a.jsxs)("div",{className:c()["panorama-main"],children:[(0,a.jsxs)("div",{className:c()["compass-container"],children:[(0,a.jsxs)("div",{className:c().compass,children:[(0,a.jsx)("div",{id:"compassContainer",className:c()["compass-inner"]}),(0,a.jsx)("div",{className:c()["compass-top-indicator"]}),(0,a.jsx)("div",{className:c()["compass-bottom-indicator"]})]}),(0,a.jsxs)("div",{className:c()["stage-container"],children:[(0,a.jsxs)("div",{id:"navi",className:c()["round-contents"],children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:c()["span-1"],children:["Round",f]}),(0,a.jsxs)("span",{className:c()["span-2"],children:["/ ",b]})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("span",{className:c()["span-2"],children:["score ",(null==o?void 0:null===(t=o.score)||void 0===t?void 0:t.toLocaleString())||"-"]})})]}),(0,a.jsxs)("div",{id:"daily_navi",className:c()["round-contents"],style:{display:"none"},children:[(0,a.jsx)("div",{children:(0,a.jsxs)("span",{className:c()["span-1"],children:["Day",f]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("span",{className:c()["span-2"],children:["move ",x]})})]}),(0,a.jsx)("button",{title:"中断する",id:"close_btn",className:"".concat(c()["close-btn"]),children:(0,a.jsx)(i(),{alt:"中断する",src:"/freeguessr/images/close.svg",width:24,height:24})})]})]}),(0,a.jsx)("aside",{className:c().controls,children:(0,a.jsxs)("div",{className:c()["control-grid"],children:[(0,a.jsxs)("div",{className:"".concat(c()["control-column"]," ").concat(c()["control-column-left"]),children:[(0,a.jsxs)("div",{id:"controlZoom",className:"".concat(c()["control-group"]," ").concat(c()["control-zoom"]),children:[(0,a.jsx)("span",{className:c()["tooltip-reference"],children:(0,a.jsx)("button",{title:"ズームイン",id:"zoomIn",className:"".concat(c()["button-small"]," ").concat(c()["button-round-top"]),children:(0,a.jsx)(i(),{alt:"ズームイン",src:"/freeguessr/images/plus.svg",width:24,height:24})})}),(0,a.jsx)("span",{className:c()["tooltip-reference"],children:(0,a.jsx)("button",{title:"ズームアウト",id:"zoomOut",className:"".concat(c()["button-small"]," ").concat(c()["button-round-bottom"]),children:(0,a.jsx)(i(),{alt:"ズームアウト",src:"/freeguessr/images/minus.svg",width:24,height:24})})})]}),(0,a.jsx)("div",{className:c().control,children:(0,a.jsx)("span",{className:c()["tooltip-reference"],children:(0,a.jsx)("button",{title:"一つ戻る",id:"goBack",className:"".concat(c()["button-small"]," ").concat(c()["button-round-both"]," ").concat(c()["button-disabled"]),disabled:!0,children:(0,a.jsx)(i(),{alt:"一つ戻る",src:"/freeguessr/images/icon-undo.svg",width:24,height:24,className:c().icon})})})}),(0,a.jsx)("div",{className:c().control,children:(0,a.jsx)("span",{className:c()["tooltip-reference"],children:(0,a.jsx)("button",{title:"チェックポイントを設定/チェックポイントに移動",id:"goCheckpoint",className:"".concat(c()["button-small"]," ").concat(c()["button-round-both"]),children:(0,a.jsx)(i(),{alt:"チェックポイントを設定",src:p,width:24,height:24,className:c().icon})})})}),(0,a.jsx)("div",{className:c().control,children:(0,a.jsx)("span",{className:c()["tooltip-reference"],children:(0,a.jsx)("button",{title:"スタートに戻る",id:"goStart",className:"".concat(c()["button-small"]," ").concat(c()["button-round-both"]),children:(0,a.jsx)(i(),{alt:"スタートに戻る",src:"/freeguessr/images/icon-return-to-start.svg",width:22,height:24,className:c().icon})})})})]}),(0,a.jsx)("div",{className:c()["friend-chat-button"]})]})}),(0,a.jsxs)("div",{className:c()["map-container"],children:[(0,a.jsxs)("div",{id:"guess_map",className:c()["guess-map"],children:[(0,a.jsxs)("div",{id:"guess_map_canvas",className:c()["guess-map-canvas"],children:[(0,a.jsx)("div",{id:"resizer",className:c().resizer}),(0,a.jsx)("button",{title:"地図のサイズを固定",id:"pinner",className:c().pinner,children:(0,a.jsx)(i(),{alt:"地図のサイズを固定",src:"/freeguessr/images/stick.svg",width:32,height:32,className:c()["pinner-img"]})})]}),(0,a.jsx)("div",{className:c()["guess-map-button"],children:(0,a.jsx)("button",{id:"guess_btn",className:"".concat(c()["guess-button"]," ").concat(c()["button-disabled"]),disabled:!0,children:(0,a.jsx)("span",{children:_})})})]}),(0,a.jsx)("div",{id:"guess_map_toggle",className:c()["guess-map_toggle"],children:(0,a.jsx)("button",{title:"地図の表示/非表示を切り替え",children:(0,a.jsx)(i(),{alt:"Guess button icon",src:"/freeguessr/images/map.svg",width:24,height:24})})})]})]})})]})}},1258:e=>{e.exports={"street-view-container":"play_street-view-container__3C2nC","street-view":"play_street-view__fv_2P","street-view-stop":"play_street-view-stop__lZ8mX","clock-container":"play_clock-container__XHYuB","timer-container":"play_timer-container__XpKpm",timer:"play_timer__pb9VS","timer-svg":"play_timer-svg__rKWA8","panorama-layout":"play_panorama-layout__XKmod","panorama-main":"play_panorama-main__gFkok","compass-container":"play_compass-container__y_F_K",compass:"play_compass__Z1DOy","compass-inner":"play_compass-inner__V_xJo","latitude-item":"play_latitude-item__J6lfq","latitude-lines":"play_latitude-lines__2V9ex","latitude-label":"play_latitude-label__hEV8K",north:"play_north__fcDZF","compass-top-indicator":"play_compass-top-indicator__0tpF8","compass-bottom-indicator":"play_compass-bottom-indicator__JEqSj",controls:"play_controls__uRXd3","control-grid":"play_control-grid__tgK2J","control-column":"play_control-column__RHGOF","control-column-left":"play_control-column-left__0yPQd","control-group":"play_control-group__d45By","button-small":"play_button-small__volvC","button-round-both":"play_button-round-both__PqCil","button-round-top":"play_button-round-top__Mvw5C","button-round-bottom":"play_button-round-bottom__zdwIe",icon:"play_icon__Ei1eX","map-container":"play_map-container__fk7Gu","guess-map":"play_guess-map__Sa3DA","guess-map-hover":"play_guess-map-hover__4iyO4","guess-map-canvas":"play_guess-map-canvas__Rf7qN","guess-map-canvas-resize":"play_guess-map-canvas-resize__mVUa3","guess-button":"play_guess-button__N_oC3","guess-allowed":"play_guess-allowed__keG7A","guess-map_toggle":"play_guess-map_toggle__E3Ugr","button-disabled":"play_button-disabled__4XR6o",resizer:"play_resizer__RFhtN",pinner:"play_pinner__U_xvL","pinner-img":"play_pinner-img__aFSxK","pinner-pin":"play_pinner-pin__ehOP9","stage-container":"play_stage-container__bS0Lh","round-contents":"play_round-contents__IH4hK","span-1":"play_span-1__ILTX2","span-2":"play_span-2__uSdVh","close-btn":"play_close-btn__HnOTg","control-zoom":"play_control-zoom__a4Za9","control-zoom-display":"play_control-zoom-display__bZfPT",loading:"play_loading__KFOBr",loadingIcon:"play_loadingIcon__VBUe8",spin:"play_spin__AcOLb"}}}]);